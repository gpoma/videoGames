

function onWindowResizeMobile(){
    var ratio = window.innerWidth / window.innerHeight;
    var pad = window.innerWidth / 2 - 32;
    if(ratio < 1){
        $("#footer").hide();
        $("#footer-turn-mobile").show();
        $("#footer-turn-mobile .turn-mobile").show();
        $("#footer-turn-mobile .turn-mobile img").css('right',pad+"px");
    }else {
        $("#footer-turn-mobile .turn-mobile").hide();
        $("#footer").show();
    }
}



function stopVideo(numberVideo){
  videoElt = document.getElementById( 'video_'+numberVideo );
  if(videoElt){
      videoElt.pause();
      videoElt.currentTime = 0;
      videoElt.pause();
  }
}

/* Changement de la vidÃ©o */
function changeVideo(pathGame, numberVideo, footerDelay = 0, pause = false, pauseafter = 0, transitionDuration = 120, priorVid = true){
  var mobile = $('video').first().hasClass('mobile');
  var videoElt = document.getElementById('video_'+numberVideo);

  if(videoElt === null){
      var video = document.createElement('video');
      if(mobile){ video.classList.add("mobile"); }
      var sourceMP4 = document.createElement("source");
          sourceMP4.type = "video/mp4";
          sourceMP4.src = pathGame+numberVideo+'.mp4';
      video.appendChild(sourceMP4);
      var sourceWebm = document.createElement("source");
          sourceWebm.type = "video/webm";
          sourceWebm.src = pathGame+numberVideo+'.webm';
      video.appendChild(sourceWebm);
      video.id = 'video_'+numberVideo;
      video.setAttribute("webkit-playsinline","");
      if(mobile){
          document.body.firstChild.insertBefore(video,document.body.firstChild.firstChild);
        }else {
          document.body.insertBefore(video,document.body.firstChild);
      }
  }

  videoElt = document.getElementById( 'video_'+numberVideo );
  videoElt.pause();
  videoElt.currentTime = 0;
  videoElt.setAttribute('autoplay',true);

  videoElt.play();
  if(debug){
    var hash = window.location.hash.replace('#','');
    if(hash != ''){
        location.hash = '';
    }
    window.history.pushState('page2', 'Title', window.location+numberVideo);
  }

  if(pause){
    setTimeout(function(){ videoElt.pause(); },pauseafter);
  }
     $("video").each(function(){
          if(($(this).attr("id") != videoElt.id) && (videoElt.paused === false)){
              TweenLite.to($(this), transitionDuration, {css: { opacity : 0}});
          }
    });


    if(priorVid){
        removeOtherVidAndTween(videoElt,transitionDuration);
    }else{
        setTimeout(function(){
            if($("video").length > 1){
                removeOtherVidAndTween(videoElt,transitionDuration);
            }
        },transitionDuration);
    }
    setTimeout(function(){
            TweenLite.to(videoElt, transitionDuration/2, {css: { opacity : 1}});
    }, transitionDuration);

  if(footerDelay == 'infini'){ return; }
  $( "#footer" ).animate({
    bottom: "-80px"
  }, footerDelay);
}

function removeOtherVidAndTween(videoElt,transitionDuration){
    $("video").each(function(){
        if(($(this).attr("id") != videoElt.id) && (videoElt.paused === false)){
            this.pause();
            delete this;
            $(this).remove();
        }else{
            var v = document.getElementById($(this).attr('id').replace("#",''));
            v.play();
            videoElt.play();
        }
    });
    TweenLite.to(videoElt, transitionDuration/2, {css: { opacity : 1}});
}

/*
function changeVideoMobile(pathGame, numberVideo, footerDelay = 0, pause = false, pauseafter = 0){
  $("video").each(function(){
      this.pause();
      delete this;
      $(this).remove();
  });

  var videoToPlay = document.getElementById('video_'+numberVideo);
  if(videoToPlay === null){
      var video = document.createElement('video');
      var sourceMP4 = document.createElement("source");
          sourceMP4.type = "video/mp4";
          sourceMP4.src = pathGame+numberVideo+'.mp4';
      video.appendChild(sourceMP4);
      var sourceWebm = document.createElement("source");
          sourceWebm.type = "video/webm";
          sourceWebm.src = pathGame+numberVideo+'.webm';
      video.appendChild(sourceWebm);
      video.id = 'video_'+numberVideo;
      video.setAttribute("webkit-playsinline","");

      $(document.body).append(video);
  }
  var videoToPlay = document.getElementById('video_'+numberVideo);
  if(!pause){
    videoToPlay.pause();
    videoToPlay.currentTime = 0;
    videoToPlay.play();
  }else{
    videoToPlay.play();
    setTimeout(function(){ videoToPlay.pause(); },pauseafter);
  }

  if(footerDelay == 'infini'){ return; }
  $( "#footer" ).animate({
    bottom: "-80px"
  }, footerDelay);
}*/


/** KeyBoardAzerty **/
var keyboardAzerty = ["97","122","101","114","116","121","117","105","111","112","113","115","100","102","103","104","106","107","108","109","119","120","99","118",
"98","110","44","59"];

/** mapping keyBoard **/
function createMappedKeyboard(firstVideo,lastVideo,random = false){
  var numberVideo = lastVideo - firstVideo + 2;
  var mappedKeyboard = [];

  if(random){
    for (var key in keyboardAzerty) {
      mappedKeyboard[keyboardAzerty[key]] = Math.floor(Math.random() * (Math.floor(lastVideo) - Math.ceil(firstVideo) +1)) + Math.ceil(firstVideo);
    }
    return mappedKeyboard;
  }

  var currentVid = firstVideo;

  for (var key in keyboardAzerty) {
    if(!(currentVid % numberVideo)){
      currentVid=firstVideo;
    }
    mappedKeyboard[keyboardAzerty[key]] = currentVid;
    currentVid++;
  }
  return mappedKeyboard;
}

function displaySkipBtn(){
  $("#skip").show();
}

function undisplaySkipBtn(){
  $("#skip").hide();
}

function loadText(textStr,footerDelay,ismobile = false){
  var text = textStr.replaceAll("\n", "<br/>");

if(!ismobile){
    var pattern = /link ('[A-Z]+') ([0-9]+)?/ig;
    var matches = text.match(pattern);
    if(matches){
      for (var i = 0; i < matches.length; i++) {
        var match = matches[i];
        var fct = match.replace(/link ('[A-Z]+') ([0-9]+)?/ig,"renderLink($1,$2)");
        var link = eval(fct);
        text = text.replaceAll(match,link);
      }
    }
  }else{
    text = text.replaceAll('Gauche',"&nbsp;<span class='glyphicon glyphicon-arrow-left' ></span>&nbsp;");
    text = text.replaceAll('Droite',"&nbsp;<span class='glyphicon glyphicon-arrow-right' ></span>&nbsp;");
    text = text.replaceAll('Haut',"&nbsp;<span class='glyphicon glyphicon-arrow-up' ></span>&nbsp;");
    text = text.replaceAll('Bas',"&nbsp;<span class='glyphicon glyphicon-arrow-down' ></span>&nbsp;");
    text = text.replaceAll('Tap',"&nbsp;<span class='glyphicon glyphicon-hand-down' ></span>&nbsp;");

  }

  $("#footer").show();
  $("#footer span.text").html(text);
  if(footerDelay == 'infini'){ return; }
  bottomValue = (ismobile)? "74px" : "0px";
  $( "#footer" ).animate({
    bottom: bottomValue
    }, footerDelay, function() {
  });
  if(!text){
    $("#footer").hide();
    bottom: "-80px"
  }

}



function loadDictionnaire(dictionnairetxt,delay){
  var dictionnaireText = dictionnairetxt.replaceAll("\n", "<br/>");
  dictionnaireText = dictionnaireText.replaceAll(" ", "&nbsp;");
  $("#dictionnaire").show();
  $("#dictionnaire span.text").html(dictionnaireText);
  var h = $("#dictionnaire span.text").height() + $("#dictionnaire span.text").parent().height();
  $("#dictionnaire").css("height",h+20);
  if(delay == 'infini'){ return; }
  $( "#dictionnaire" ).animate({
    bottom: "0px"
    }, delay, function() {
  });
  if(!dictionnaireText){
    $("#dictionnaire").hide();
    left: "0px"
  }
}

function renderLink(str,code){
  return "\"<a href='#' onClick='triggerKeypress("+code+"); return false;' style='color:#fff;' >"+str+"</a>\"";
}

function triggerKeypress(code){
  var kp = jQuery.Event("keypress");
  kp.which = code;
  kp.keyCode = code;

  $(document).trigger(kp);

  var ku = jQuery.Event("keyup");

  ku.which = code;
  ku.keyCode = code;

  $(document).trigger(ku);
};
